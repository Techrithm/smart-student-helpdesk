<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Student Helpdesk</title>
    <!-- Corrected path relative to frontend/ folder -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .hero-text {
            text-align: center;
            margin-bottom: 3rem;
            color: #2b2d42;
        }
    </style>
</head>

<body>

    <header>
        <div class="container nav">
            <a href="index.html" class="logo">SmartHelpdesk</a>
        </div>
    </header>

    <div class="container">
        <div class="hero-text">
            <h1>Welcome to Smart Student Helpdesk</h1>
            <p>Efficiently track and resolve campus issues. Select your role to continue.</p>
        </div>

        <div class="role-select">
            <!-- Student Card -->
            <div class="role-card">
                <div>
                    <h2>ğŸ‘¨â€ğŸ“ Student</h2>
                    <p>Raise tickets, track status, and chat with staff.</p>
                </div>
                <div>
                    <a href="student/login.html" class="btn">Login</a>
                    <div style="margin-top: 15px;">
                        <a href="student/register.html" style="color: var(--primary); font-weight: 500;">New User?
                            Register</a>
                    </div>
                </div>
            </div>

            <!-- Staff Card -->
            <div class="role-card">
                <div>
                    <h2>ğŸ‘¨â€ğŸ« Staff</h2>
                    <p>Manage department complaints and provide solutions.</p>
                </div>
                <div>
                    <a href="staff/login.html" class="btn btn-secondary"
                        style="background-color: var(--secondary);">Login</a>
                </div>
            </div>

            <!-- Admin Card -->
            <div class="role-card">
                <div>
                    <h2>âš™ï¸ Admin</h2>
                    <p>Manage users, departments, and oversee system.</p>
                </div>
                <div>
                    <a href="admin/login.html" class="btn btn-dark">Login</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function checkSession() {
            try {
                // Adjust path as index.html is in frontend/, check_session is in backend/auth/
                // Relative path from frontend/index.html to backend/auth/check_session.php is ../backend/auth/check_session.php
                const response = await fetch('../backend/auth/check_session.php');
                const result = await response.json();

                if (result.logged_in) {
                    const userRole = result.user.role;
                    let dashboardLink = '#';
                    if (userRole === 'student') dashboardLink = 'student/dashboard.html';
                    if (userRole === 'staff') dashboardLink = 'staff/dashboard.html';
                    if (userRole === 'admin') dashboardLink = 'admin/dashboard.html';

                    // Update UI for logged in user
                    updateRoleCard('Student', userRole === 'student', dashboardLink);
                    updateRoleCard('Staff', userRole === 'staff', dashboardLink);
                    updateRoleCard('Admin', userRole === 'admin', dashboardLink);
                }
            } catch (error) {
                console.error('Session check failed', error);
            }
        }

        function updateRoleCard(roleName, isCurrentRole, dashboardLink) {
            // Find the card
            const cards = document.querySelectorAll('.role-card');
            cards.forEach(card => {
                const title = card.querySelector('h2').innerText;
                if (title.includes(roleName)) {
                    if (isCurrentRole) {
                        const btn = card.querySelector('.btn');
                        btn.textContent = 'Go to Dashboard';
                        btn.href = dashboardLink;
                        btn.classList.add('btn-success');

                        // Hide register link if exists (Student card)
                        const registerDiv = card.querySelector('div[style*="margin-top"]');
                        if (registerDiv) registerDiv.style.display = 'none';
                    }
                }
            });
        }

        checkSession();
    </script>
</body>

</html>